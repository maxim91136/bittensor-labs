# v1.0.0-rc.8.1 Release Notes

**Release Date:** 29 November 2025  
**Previous Release:** v1.0.0-rc.8 (29 November 2025)

## Overview

RC8.1 introduces **Network History Tracking** ‚Äî a foundation for long-term network metrics analysis. Builds on RC8's multi-timeframe volume trend detection with new infrastructure for collecting and archiving Bittensor SDK data (blockHeight, validators, subnets, emissions, halving projections).

## New Features

### üìä Network History Collection
- **Automatic Data Gathering**: `publish-network.yml` (every 15 min) + `backup-network-history-r2.yml` (every 3 hours)
- **API Endpoint**: `GET /api/network/history` returns JSON array of timestamped network snapshots
- **Data Structure**: Mirrors taostats pattern for consistency
  ```json
  [
    {
      "_timestamp": "2025-11-29T22:31:30Z",
      "blockHeight": 6991619,
      "validators": 1461,
      "subnets": 129,
      "emission_7d": 6519.37,
      "totalIssuanceHuman": 10402881.11742588,
      ...
    }
  ]
  ```

### üîÑ Workflows
- **`publish-network.yml`**: Fetches metrics + merges history to KV (15 min interval)
- **`backup-network-history-r2.yml`**: Archives history to R2 every 3 hours for long-term storage

### üõ†Ô∏è Infrastructure
- **`merge-network-history.py`**: Robust Python-based history merging with proper JSON handling
- **Monitoring Scripts**: 
  - `monitor-network-history.sh`: Interactive dashboard for collection progress
  - `.github/scripts/monitor-network-history.sh`: CI-ready monitoring

### üìñ Documentation
- **`docs/NETWORK_HISTORY_MONITORING.md`**: Complete guide for data collection, KV storage calculations, workflow health checks, troubleshooting

## Technical Changes

### Backend (`fetch_network.py`)
- Added `network_latest.json` generation (tracks current snapshot for history appending)
- Integrated with existing emission calculation and halving projection logic

### Workflows
- `publish-network.yml`: Added "Push Network history to Cloudflare KV" step
  - Merges `network_latest` with existing `network_history` from KV
  - Deduplicates by `_timestamp`
  - Safe fallback handling
  
- `backup-network-history-r2.yml`: New dedicated workflow (separate from per-run archival)
  - Fetches complete history every 3 hours
  - Timestamps snapshots: `network_history-YYYYMMDDTHHMMSSZ.json`
  - Uploads to R2 for versioned long-term storage

### API (`functions/api/network-history.js`)
- New endpoint: `GET /api/network/history`
- Returns KV key `network_history` as JSON array
- CORS enabled, caching: 60s (edge) / 120s (browser)
- Graceful handling of missing/corrupt data

## Data Collection Status

**Collection Timeline:**
- **15-minute intervals** from Bittensor SDK via `fetch_network.py`
- **~96 entries per day**
- **Current (Nov 29)**: 253 snapshots, ~6 days of history
- **Target for Phase 4 (Frontend)**: 7+ days (~672 entries)

**Storage Projection:**
- ~500B per snapshot
- Annual growth: ~174 MB (exceeds 100MB KV limit)
- R2 archival handles long-term retention

## Bug Fixes

- **Network History Merging**: Fixed jq type mismatch errors by switching to Python script
  - Properly handles Cloudflare API responses
  - Safe deduplication by `_timestamp`
  - Clear error logging for debugging

- **Workflow Name Cleanup**: Removed "(fixed)" suffix from `publish-network.yml` display name

## Next Steps

### Phase 4: Frontend Charting (Expected: Dec 1, 2025)
- Historical charts: BlockHeight progression
- Emissions trend (7d/30d averages)
- Validators/Subnets growth visualization
- Halving ETA updates from historical data

### Phase 5: Data Management (Post-Production)
- KV size monitoring and cleanup policies
- R2 lifecycle configuration
- Historical data retention strategy

## Deployment Checklist

- [x] Network history collection workflows active
- [x] API endpoint returning data
- [x] R2 backup archival running
- [x] Monitoring scripts ready
- [x] Documentation complete
- [x] Error handling robust
- [ ] Frontend integration (Phase 4)

## Testing

**Manual Verification:**
```bash
# Check latest network metrics
curl https://your-worker.example.com/api/network/history | jq '.[-1]'

# Count history entries
curl https://your-worker.example.com/api/network/history | jq 'length'

# Monitor collection progress
./monitor-network-history.sh
watch -n 60 ./monitor-network-history.sh
```

**CI Validation:**
- ‚úÖ publish-network.yml: All 8 steps passing
- ‚úÖ merge-network-history.py: Safe JSON handling
- ‚úÖ backup-network-history-r2.yml: Ready (3h schedule)

## Known Limitations

1. **Collection Started Late**: Nov 29, 2025, ~6 days of history at release
   - Sufficient for Phase 4 by Dec 1, 2025
   - Full year of data by late Nov 2026

2. **KV Size Growth**: ~174 MB/year at current sampling rate
   - 100 MB KV limit reached ~7-8 months
   - R2 archival recommended for years 2+

## Files Changed

**New Files:**
- `.github/scripts/merge-network-history.py`
- `.github/workflows/backup-network-history-r2.yml`
- `functions/api/network-history.js`
- `monitor-network-history.sh` (root-level dashboard)
- `docs/NETWORK_HISTORY_MONITORING.md`

**Modified Files:**
- `.github/scripts/fetch_network.py`: Added `network_latest.json` generation
- `.github/workflows/publish-network.yml`: Added history merge step
- `VERSION`: v1.0.0-rc.8 ‚Üí v1.0.0-rc.8.1
- `README.md`: Updated latest release pointer

## Contributors

- Network history architecture + workflows
- Python merge script for robust KV updates
- Monitoring dashboard + documentation

## Support & Issues

For workflow failures or data collection issues, see:
- `docs/NETWORK_HISTORY_MONITORING.md` ‚Üí Troubleshooting section
- GitHub Actions logs: `Actions` ‚Üí `publish-network.yml` / `backup-network-history-r2.yml`

---

**Next Release:** v1.0.0-rc.9 (Phase 4: Frontend Charts) ‚Äî Expected early December 2025
